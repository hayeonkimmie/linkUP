<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
        "http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="mapper.qna">

    <!-- ì‚¬ìš©ìžë³„ QnA ê°œìˆ˜ -->
    <select id="selectQnACntByUserId" parameterType="String" resultType="Integer">
        SELECT COUNT(*) FROM qna WHERE user_id = #{userId}
    </select>

    <!-- ì‚¬ìš©ìžë³„ QnA ëª©ë¡ (íŽ˜ì´ì§€ ì²˜ë¦¬ í¬í•¨) -->
    <select id="selectQnAListByPage" parameterType="Map" resultType="qna">
        SELECT * FROM qna
        WHERE user_id = #{userId}
        ORDER BY qna_id DESC
        LIMIT #{row}, 3
    </select>

    <!-- ì „ì²´ QnA ëª©ë¡ (íŽ˜ì´ì§€ ì²˜ë¦¬ í¬í•¨) -->
    <select id="selectQnAList" parameterType="Integer" resultType="qna">
        SELECT * FROM qna
        ORDER BY answer_date DESC
        LIMIT #{row}, 3
    </select>

    <!-- ì „ì²´ QnA ê°œìˆ˜ -->
    <select id="selectQnACount" resultType="Integer">
        SELECT COUNT(*) FROM qna
    </select>

    <!--  í•„í„°ë¥¼ ì ìš©í•œ QnA ê°œìˆ˜ -->
    <select id="selectQnACountWithFilter" parameterType="map" resultType="int">
        SELECT COUNT(*) FROM qna
        <where>
            <if test="status != null and status != ''">
                <choose>
                    <when test="status == 'waiting'">
                        AND answer_content IS NULL
                    </when>
                    <when test="status == 'complete'">
                        AND answer_content IS NOT NULL
                    </when>
                </choose>
            </if>

            <if test="keyword != null and keyword != ''">
                AND question_title LIKE CONCAT('%', #{keyword}, '%')
            </if>
        </where>
    </select>

    <!-- ðŸ”¥ í•„í„° + ì •ë ¬ + íŽ˜ì´ì§•ëœ QnA ëª©ë¡ -->
    <select id="selectQnAListWithFilter" parameterType="map" resultType="qna">
        SELECT * FROM qna
        <where>
            <if test="status != null and status != ''">
                <choose>
                    <when test="status == 'waiting'">
                        AND answer_content IS NULL
                    </when>
                    <when test="status == 'complete'">
                        AND answer_content IS NOT NULL
                    </when>
                </choose>
            </if>

            <if test="keyword != null and keyword != ''">
                AND question_title LIKE CONCAT('%', #{keyword}, '%')
            </if>
        </where>
        ORDER BY question_date
        <choose>
            <when test="sort != null and sort == 'asc'">ASC</when>
            <otherwise>DESC</otherwise>
        </choose>
        LIMIT #{row}, 3
    </select>

    <!-- QnA ë“±ë¡ -->
    <insert id="insertQna" parameterType="qna">
        INSERT INTO qna (
            qna_id, user_id, question_title, question_content, question_date, answer_content, answer_date
        )
        VALUES (
                   #{qnaId}, #{userId}, #{questionTitle}, #{questionContent}, #{questionDate}, #{answerContent}, #{answerDate}
               )
    </insert>

</mapper>
